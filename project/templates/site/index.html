{% extends 'site/layout.html' %}
{% block content %}
<div class="container">
	<div class="content-top1">
		<div class="row">
			<div class="col-md-3 hidden-sm hidden-xs" style="display:none">
				<div class="wrap-cat-icon wrap-cat-icon1">
					<h2 class="title14 title-cat-icon">دسته بندی ها</h2>
					<ul class="list-cat-icon">

					</ul>
				</div>
			</div>
			<div class="col-md-12 col-sm-12 col-xs-12">
				<div class="wrap-banner-slider1">
					<div class="banner-slider banner-slider1">
						<div class="wrap-item ads_banner" data-autoplay="true" data-pagination="false" data-navigation="true" data-itemscustom="[[0,1]]" data-transition="fade" data-bind="foreach: ads">
							<div class="item-banner item-banner1">
								<div class="banner-thumb">
									<a href="#"><img data-bind="attr:{src : ad_image_path + ClearifyNames(images)[0]}" alt="" /></a>
								</div>
								<div class="banner-info animated" data-animated="lightSpeedIn">
									<h2 class="title30" data-bind="text: title"></h2>
									<h2 class="title30 color">تخفیف: <span>تا </span> <span data-bind="text:ToPersian(discount)"></span>% <span> قیمت</span></h2>
									<p data-bind="text: description"></p>
									<a href="#" class="shopnow"><span data-bind="text: link_title"></span></a>
								</div>
							</div>

						</div>
					</div>
					<!-- End Banner -->
					<div class="sub-banner-slider">
						<div class="wrap-item sub-ads-slider" data-pagination="false" data-navigation="true" data-itemscustom="[[0,1],[560,3],[1024,4]]">

						</div>
					</div>
					<!-- End Sub Banner -->
				</div>
			</div>
		</div>
	</div>
	<div class="events_container" data-bind="foreach:events">
		<div class="intro-countdown">
			<h2 class="title30"> ٪<strong class="color" data-bind="text: discount "></strong> <span data-bind="text:description"></span> <span class="color"> محدود </span></h2>
			<div class="deals-cowndown" data-bind="attr:{ 'data-date' : deadline}"></div>
		</div>
		<!-- ko text: triggerBigTimer () -->
		<!-- /ko -->
		<!-- End Intro Countown -->
	</div>

</div>
<div class="list-flash">
	<div class="container">
		<h2 class="title24 title-flash"><span class="bg-color white">حراجی های امروز</span></h2>
		<div class="row" data-bind="foreach:auctions">
			<div class="col-md-4 col-sm-6 col-xs-12">
				<div class="banner-flash">
					<div class="banner-zoom">
						<a href="#" class="thumb-zoom"><img data-bind="attr:{src : image}" alt="" /></a>
						<div class="flash-label">
							<span class="text-uppercase white"><span data-bind="text:participant_count"></span> از <span data-bind="text:max_members"></span> </span>
						</div>
						<div class="flash-label right-time">
							<span class="text-uppercase white"><div class="flash-countdown" data-bind = "attr:{'data-date':deadline}" ></div></span>
						</div>
					</div>
					<div class="flash-info">
						<ul class="list-none clearfix">
							<li>
								<div class="flash-timer">
									<p data-bind="text:title"></p>
								</div>
							</li>
							<li>
								<div class="flash-timer">
									{% if current_user.is_authenticated %}
									<a data-bind="attr:{href:link}" class="quickview-link fancybox.iframe btn-rect white bg-color radius"><span>شرکت در حراجی</span></a>
									{% else %}
									<a href="/ilogin" class="quickview-link fancybox.iframe btn-rect white bg-color radius"><span>ورود</span></a>
									{% endif %}
								</div>
							</li>
							<li>
								<div class="info-pro-hotdeal">
									<div class="deal-percent">
										<span>شروع حراجی:</span>
										<span data-bind="text:base_price"></span>
									</div>
									<div class="product-price">
										<label>قیمت محصول:</label>
										<ins><span data-bind="text:price"></span></ins>
									</div>
								</div>
							</li>
						</ul>
					</div>
				</div>
			</div>
			<!-- ko text: triggerFlashTimer () -->
			<!-- /ko -->
			<!-- End Intro Countown -->
		</div>
	</div>
</div>
<!-- ENd Flash -->
	<div class="product-hotdeal" >
		<div class="header-hotdeal">
			<div class="container">
				<div class="title-box1">
					<h2 class="title30"><span><i class="fa fa-legal" aria-hidden="true"></i></span><a href="#">بهترین ها</a></h2>
					<ul class="list-none">
						<li class="active"><a href="#hot1" data-toggle="tab">بر اساس محبوبیت</a></li>
						<li><a href="#hot2" data-toggle="tab">بر اساس بازدید</a></li>
					</ul>
				</div>
			</div>
		</div>
		<!-- End Header Hotdeal -->
		<div class="content-hotdeal tab-content">
			<div id="hot1" class="tab-pane active">
				<div class="hotdeal-slider">
					<div class="wrap-item" data-itemscustom="[[0,1],[560,2],[768,3],[1024,4],[1200,5],[1366,6]]" data-pagination="false" data-autoplay="true" data-navigation="true" data-bind="foreach:populars">
						<div class="item-pro-hotdeal">
							<div class="product-thumb">
								<a href="#" class="product-thumb-link">
									<img data-bind="attr:{src : image}" alt="">
								</a>
								<a data-bind="attr:{href:instance_link}" class="quickview-link pos-bottom fancybox.iframe"><span>مشاهده سریع</span></a>
							</div>
							<div class="product-info">
								<h3 class="product-title"><a href="#" data-bind="text:title"></a></h3>
								<div class="info-pro-hotdeal">
									<div class="deal-percent">
										<span>شروع حراجی:</span>
										<span data-bind="text:base_price"></span>
									</div>
									<div class="product-price">
										<del><span>قیمت محصول</span></del>
										<ins><span><span data-bind="text : price"></span> تومان</span></ins>
									</div>
								</div>
								<div class="product-extra-link2">
									{% if current_user.is_authenticated %}
									<a data-bind="attr:{href:link}" class="addcart-link quickview-link fancybox.iframe">شرکت در حراجی</a>
									<a href="#" class="wishlist-link"><i class="fa fa-heart" aria-hidden="true"></i></a>
									{% else %}
									<a href="/ilogin" class="addcart-link quickview-link fancybox.iframe"><span>ورود</span></a>
									{% endif %}
								</div>
							</div>
						</div>

						<!-- End Item -->
					</div>
				</div>
			</div>
			<!-- ENd Tab -->
			<div id="hot2" class="tab-pane">
				<div class="hotdeal-slider">
					<div class="wrap-item" data-itemscustom="[[0,1],[560,2],[768,3],[1024,4],[1200,5],[1366,6]]" data-pagination="false" data-autoplay="true" data-navigation="true" data-bind="foreach:views">

						<div class="item-pro-hotdeal">
							<div class="product-thumb">
								<a href="#" class="product-thumb-link">
									<img data-bind="attr:{src : image}" alt="">
								</a>
								<a data-bind="attr:{href:instance_link}" class="quickview-link pos-bottom fancybox.iframe"><span>مشاهده سریع</span></a>
							</div>
							<div class="product-info">
								<h3 class="product-title"><a href="#" data-bind="text:title"></a></h3>
								<div class="info-pro-hotdeal">
									<div class="deal-percent">
										<span>شروع حراجی:</span>
										<span data-bind="text:base_price"></span>
									</div>
									<div class="product-price">
										<del><span>قیمت محصول</span></del>
										<ins><span><span data-bind="text : price"></span> تومان</span></ins>
									</div>
								</div>
								<div class="product-extra-link2">
									{% if current_user.is_authenticated %}
									<a data-bind="attr:{href:link}" class="addcart-link quickview-link fancybox.iframe">شرکت در حراجی</a>
									<a href="#" class="wishlist-link"><i class="fa fa-heart" aria-hidden="true"></i></a>
									{% else %}
									<a href="/ilogin" class="addcart-link quickview-link fancybox.iframe"><span>ورود</span></a>
									{% endif %}
								</div>
							</div>
						</div>
						<!-- End Item -->

					</div>
				</div>
			</div>
			<!-- ENd Tab -->
		</div>
		<!-- End Content Hot Deal -->
	</div>
	<div class="service-footer3 service-footer11">
		<div class="container">
			<div class="service-slider3">
				<div class="wrap-item" data-pagination="false" data-navigation="false" data-items="6">
					<div class="item-service3 white">
						<a class="service-icon" href="#"><img src="static/images/theme/for1.png" alt="" /></a>
						<h2 class="title14">شرکت کنید</h2>
						<p>مورد نظر در اینجا نوشته شود مورد نظر در اینجا نوشته شود مورد نظر در </p>
					</div>
					<div class="item-service3 white">
						<a class="service-icon" href="#"><img src="static/images/theme/for2.png" alt="" /></a>
						<h2 class="title14">تحویل ۲۴ ساعته</h2>
						<p>مورد نظر در اینجا نوشته شود مورد نظر در اینجا نوشته شود مورد نظر در </p>
					</div>
					<div class="item-service3 white">
						<a class="service-icon" href="#"><img src="static/images/theme/for3.png" alt="" /></a>
						<h2 class="title14">پرداخت امن</h2>
						<p>مورد نظر در اینجا نوشته شود مورد نظر در اینجا نوشته شود مورد نظر در </p>
					</div>
					<div class="item-service3 white">
						<a class="service-icon" href="#"><img src="static/images/theme/for4.png" alt="" /></a>
						<h2 class="title14">فروشگاهی با اعتبار</h2>
						<p>مورد نظر در اینجا نوشته شود مورد نظر در اینجا نوشته شود مورد نظر در </p>
					</div>
					<div class="item-service3 white">
						<a class="service-icon" href="#"><img src="static/images/theme/for5.png" alt="" /></a>
						<h2 class="title14">پشتیبانی ۲۴ ساعته</h2>
						<p>مورد نظر در اینجا نوشته شود مورد نظر در اینجا نوشته شود مورد نظر در </p>
					</div>
					<div class="item-service3 white">
						<a class="service-icon" href="#"><img src="static/images/theme/for6.png" alt="" /></a>
						<h2 class="title14">اپلیکیشن موبایل</h2>
						<p>مورد نظر در اینجا نوشته شود مورد نظر در اینجا نوشته شود مورد نظر در </p>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="container" data-bind="foreach:categories">
		<div class="deal-box18">
			<h2 class="white title30 text-center"><span data-bind="text:title"></span></h2>
			<div class="deal-slider18 poly-slider border bg-white">
				<div class="wrap-item" data-bind ="foreach : auctions" >
					<div class="deal-pro18">
						<div class="product-thumb">
							<a href="#" class="product-thumb-link zoomout-thumb">
								<img data-bind="attr:{src: product_image_path+'/'+ClearifyNames(item.product.images)[0] }" alt="">
								<img data-bind="attr:{src: product_image_path+'/'+ClearifyNames(item.product.images)[0] }" alt="">
							</a>
							<a href="quick-view.html" class="quickview-link plus pos-middle fancybox.iframe">مشاهده سریع</a>
						</div>
						<h2 class="title14"><a href="#" data-bind="text:title" ></a></h2>
						<div class="product-info">
							<div class="product-price">
								<ins>شروع از : <span data-bind="text:ToPersian(formatCurrency(base_price))"></span></ins>
								{% if current_user.is_authenticated %}
								<a data-bind="attr:{href : '/participate/'+id}"  class="quickview-link fancybox.iframe addcart-link bg-color white radius">ثبت نام</a>
								{% else %}
								<a href="/ilogin" class="quickview-link fancybox.iframe btn-rect white bg-color radius"><span>ورود</span></a>
								{% endif %}

								<!-- <del><span>$65.00</span></del> -->
							</div>
						</div>
						<div class="deal-timer18 poly-box">
							<div class="flash-countdown" data-bind='attr:{"data-date" : new Date(end_date).format("yyyy-M-d hh:mm:ss TT","UTC") }'></div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<!-- ko text: triggerSlider () -->
		<!-- /ko -->
		<!-- ko text: triggerFlashTimer () -->
		<!-- /ko -->

		<!-- End Deal -->
	</div>

{% endblock %}
{% block scripts %}
{{ super() }}
<script type="text/javascript" src="{{ url_for('static', filename='js/libs/knockout.js')}}"></script>
<script>



var today_auctions = []
var best_auctions = []
var ad_image_path = '../../static/images/ads/';
var product_image_path = '../../static/images/products/';
var ads = []
var events = []
var auctions = []
var populars = []
var views = []
var categories = []

function Category(title,auctions) {
	this.title = title;
	this.auctions = auctions;
}

function dealModel() {

	var self = this;
	self.ads = ko.observableArray([]);
	self.events = ko.observableArray([]);
	self.auctions = ko.observableArray([]);
	self.populars = ko.observableArray([]);
	self.views = ko.observableArray([]);
	self.categories = ko.observableArray([]);

	var categories = [];
	$.getJSON("{{url_for('categorymenuitems')}}", function(data){
		$.each(data[0],function(key,val){
			$.getJSON("api/category/"+val.id+"/auctions", function(auctions) {
				category = new Category(val.title,auctions[0]);
				OnDataReady(category);
			});
		});
	});

	function OnDataReady(data) {
		self.categories.push(data);
		console.log(category);
	}

	// $.getJSON("{{url_for('categorymenuitems')}}", function(data){
	// 	$.each(data[0],function(key,val){
	// 		$.getJSON("api/category/"+val.id+"/auctions", function(auctions) {
	// 			categories.push({title : val.title , auctions : auctions[0]});
	// 		});
	// 	});
	// });
	// console.log(categories['0']);

	// $.getJSON("{{url_for('categorymenuitems')}}", function(data){
	// 	$.each(data[0],function(key,category){
	// 		var result = []
	// 		result.title = category.title ;
	// 		result.auctions = [];
	// 		$.getJSON("api/category/"+category.id+"/auctions", function(data) {
	// 			$.each(data[0],function(key,auction){
	// 				result.auctions.push(auction);
	// 			});
	// 		});
	// 		categories.push(result);
	// 	});
	// });
	// console.log(categories);
	// self.categories(categories);

	// $.each(categories,function(key,val){
	// 	console.log(val);
	// 	var auctions = [];
	// 	$.getJSON("api/category/"+val.id+"/auctions", function(data) {
	// 		$.each(data[0],function(key,val){
	// 			auctions.push(val);
	// 		});
	// 	});
	// 	console.log(auctions);
	// });

	// 	categories = [];
	// 	$.each(data[0],function(key,val) {
	// 		category = [];
	// 		category.title = val.title;
	// 		category.items = []
	// 		$.getJSON("api/category/"+val.id+"/auctions", function(auctions) {
	// 			$.each(auctions[0],function(key1,val1){
	// 				category.items.push(val1);
	// 			});
	// 		});
	// 		categories.push(category);
	// 	});
	// 	console.log(categories);
	// 	self.categories(categories);
	// });

	$.getJSON("{{url_for('auctioncarouselads')}}", function(data) {
		self.ads(data[0]);
	})

	$.getJSON( "{{url_for('sitetodayevents')}}", function( data ) {
		$.each(data[0],function(key,val){
			e = { title : val.title , description : val.description , deadline : new Date(val.end_date).format("yyyy-M-d hh:mm:ss TT","UTC"), discount :ToPersian(val.discount)};
			events.push(e);
		})
		self.events(events)
	});

	$.getJSON( "{{url_for('sitetodayauctions')}}", function( data ) {
		$.each(data[0],function(key,val){
			auction =
			{
				title : val.title ,
				description : val.description ,
				deadline : new Date(val.end_date).format("yyyy-M-d hh:mm:ss TT","UTC"),
				participant_count :ToPersian(val.participants.length),
				max_members :ToPersian(val.max_members),
				base_price : ToPersian(formatCurrency(val.base_price)),
				max_price : ToPersian(formatCurrency(val.max_price)),
				price : ToPersian(formatCurrency(val.item.price)),
				image : product_image_path + ClearifyNames(val.item.product.images)[0],
				link : "/participate/"+ val.id
			};
			auctions.push(auction);
		});
		self.auctions(auctions)
	});

	$.getJSON( "{{url_for('sitemostpopularauctions')}}", function( data ) {
		$.each(data[0],function(key,val){
			auction =
			{
				title : val.title ,
				description : val.description ,
				deadline : new Date(val.end_date).format("yyyy-M-d hh:mm:ss TT","UTC"),
				participant_count :ToPersian(val.participants.length),
				max_members :ToPersian(val.max_members),
				base_price : ToPersian(formatCurrency(val.base_price)),
				max_price : ToPersian(formatCurrency(val.max_price)),
				price : ToPersian(formatCurrency(val.item.price)),
				image : product_image_path + ClearifyNames(val.item.product.images)[0],
				instance_link : "/instantview/"+ val.id,
				link : "/participate/"+ val.id
			};
			populars.push(auction);
		});
		self.populars(populars);
	});

//end point for most viewed products
	$.getJSON( "{{url_for('sitemostviewedauctions')}}", function( data ) {
		$.each(data[0],function(key,val){
			auction =
			{
				title : val.title ,
				description : val.description ,
				deadline : new Date(val.end_date).format("yyyy-M-d hh:mm:ss TT","UTC"),
				participant_count :ToPersian(val.participants.length),
				max_members :ToPersian(val.max_members),
				base_price : ToPersian(formatCurrency(val.base_price)),
				max_price : ToPersian(formatCurrency(val.max_price)),
				price : ToPersian(formatCurrency(val.item.price)),
				image : product_image_path + ClearifyNames(val.item.product.images)[0],
				instance_link : "/instantview/"+ val.id,
				link : "/participate/"+ val.id
			};
			views.push(auction);
		});
		self.views(views)
	});

}

ko.applyBindings(new dealModel());

function triggerBigTimer() {
	if($('.deals-cowndown').length>0){
		 $(".deals-cowndown").TimeCircles({
			 fg_width: 0.01,
			 bg_width: 1.2,
			 text_size: 0.07,
			 circle_bg_color: "#ffffff",
			 time: {
				 Days: {
					 show: true,
					 text: "روز",
					 color: "#f9bc02"
				 },
				 Hours: {
					 show: true,
					 text: "ساعت",
					 color: "#f9bc02"
				 },
				 Minutes: {
					 show: true,
					 text: "دقیقه",
					 color: "#f9bc02"
				 },
				 Seconds: {
					 show: true,
					 text: "ثانیه",
					 color: "#f9bc02"
				 }
			 }
		 });
	 	}
}

function triggerFlashTimer() {
	if($('.flash-countdown').length>0){
		$(".flash-countdown").TimeCircles({
			fg_width: 0.01,
			bg_width: 1.2,
			text_size: 0.07,
			circle_bg_color: "#ffffff",
			time: {
				Days: {
					show: false,
					text: "",
					color: "#f9bc02"
				},
				Hours: {
					show: true,
					text: "",
					color: "#f9bc02"
				},
				Minutes: {
					show: true,
					text: "",
					color: "#f9bc02"
				},
				Seconds: {
					show: true,
					text: "",
					color: "#f9bc02"
				}
			}
		});
	}
}

function triggerSlider(){
	if($('.wrap-item').length>0){
		$('.wrap-item').each(function(){
			var data = $(this).data();
			$(this).owlCarousel({
				addClassActive:true,
				stopOnHover:true,
				itemsCustom:data.itemscustom,
				autoPlay:data.autoplay,
				transitionStyle:data.transition,
				beforeInit:data.background,
				afterAction:data.animated,
				navigationText:['<i class="fa fa-angle-left" aria-hidden="true"></i>','<i class="fa fa-angle-right" aria-hidden="true"></i>'],
			});
			$(this).find('.owl-controls').css('left',data.control+'px');
		});
	}
	//BxSlider
	if($('.bxslider-banner').length>0){
		$('.bxslider-banner').each(function(){
			$(this).find('.bxslider').bxSlider({
				controls:false,
				pagerCustom: $(this).find('.bx-pager')
			});
		});
	}
}

// $.getJSON( "{{url_for('sitemostpopularauctions')}}", function( data ) {
// 	$.each( data[0], function( key, val ) {
//
// 		if(val.item.product.images)
// 			image_name = val.item.product.images.replace(/'/g, '').replace('[','').replace(']','').replace(' ','').split(',')[0];
//
// 		item_mostpopular_auction =
// 			'<div class="item-pro-hotdeal">'+
// 			'<div class="product-thumb">'+
// 			'<a href="#" class="product-thumb-link">'+
// 			'<img src=static/images/products/'+image_name+' alt="">'+
// 			'</a>'+
// 			'<a href="/instantview/'+val.id+'" class="quickview-link pos-bottom fancybox.iframe"><span>مشاهده سریع</span></a>'+
// 			'</div>'+
// 			'<div class="product-info">'+
// 			'<h3 class="product-title"><a href="#">'+val.name+'</a></h3>'+
// 			'<div class="info-pro-hotdeal">'+
// 			'<div class="deal-percent">'+
// 			'<span>شروع حراجی:</span>'+
// 			'<span>'+ToPersian(formatCurrency(val.register_price))+'</span>'+
// 			'</div>'+
// 			'<div class="product-price">'+
// 			'<del><span>قیمت محصول</span></del>'+
// 			'<ins><span>'+ToPersian(formatCurrency(val.item.price))+'تومان</span></ins>'+
// 			'</div>'+
// 			'</div>'+
// 			'<div class="product-extra-link2">'+
// 			'{% if current_user.is_authenticated %}'+
// 			'<a href="/participate/'+val.id+'" class="addcart-link quickview-link fancybox.iframe">شرکت در حراجی</a>'+
// 			'<a href="#" class="wishlist-link"><i class="fa fa-heart" aria-hidden="true"></i></a>'+
// 			'{% else %}'+
// 			'<a href="/ilogin" class="addcart-link quickview-link fancybox.iframe"><span>ورود</span></a>'+
// 			'{% endif %}'+
// 			'</div>'+
// 			'</div>'+
// 			'</div>';
//
// 		$('.mostpopular_auctions_container').append(item_mostpopular_auction);
// 	});
//
// });

</script>
{% endblock scripts %}
